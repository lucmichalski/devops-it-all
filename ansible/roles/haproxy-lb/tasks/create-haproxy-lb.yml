---
- name: Set haproxy terraform eks worker role arn variable
  shell: "{{ playbook_dir }}/../shell/set_worker_role_arn_variable.sh"

- name: Create haproxy_lb
  terraform:
    binary_path: "/home/{{ lookup('env','USER') }}/bin/terraform"
    project_path: "{{ haproxy_lb_terraform_dir }}"
    state:        present 
    lock: yes
    backend_config:
      region: "us-east-1"
      bucket: "devopsitall-terraform-remote-state"
      key: "haproxy-lb-terraform.tfstate"
      dynamodb_table:  "devopsitall-haproxy-autoscale-terraform-remote-lock"
      encrypt:  "true"
    force_init: true
  register: terraform_run
